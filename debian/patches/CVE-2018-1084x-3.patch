Backport of:

From 62a39773e9d0c4a686a3d8d2b6cca32f82c26cd7 Mon Sep 17 00:00:00 2001
From: Nikos Mavrogiannopoulos <nmav@redhat.com>
Date: Tue, 12 Jun 2018 14:29:57 +0200
Subject: [PATCH] cbc_mac_verify: require minimum padding under SSL3.0

Signed-off-by: Nikos Mavrogiannopoulos <nmav@redhat.com>
---
 lib/cipher.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

Index: gnutls28-3.4.10/lib/gnutls_cipher.c
===================================================================
--- gnutls28-3.4.10.orig/lib/gnutls_cipher.c	2019-05-28 13:26:13.143117534 -0400
+++ gnutls28-3.4.10/lib/gnutls_cipher.c	2019-05-28 13:27:16.587388822 -0400
@@ -744,7 +744,10 @@ ciphertext_to_compressed(gnutls_session_
 			 * Note that we access all 256 bytes of ciphertext for padding check
 			 * because there is a timing channel in that memory access (in certain CPUs).
 			 */
-			if (ver->id != GNUTLS_SSL3)
+			if (ver->id == GNUTLS_SSL3) {
+				if (pad >= blocksize)
+					pad_failed = 1;
+			} else {
 				for (i = 2; i <= MIN(256, ciphertext->size); i++) {
 					tmp_pad_failed |=
 					    (compressed->
@@ -752,6 +755,7 @@ ciphertext_to_compressed(gnutls_session_
 					pad_failed |=
 					    ((i <= (1 + pad)) & (tmp_pad_failed));
 				}
+			}
 
 			if (unlikely
 			    (pad_failed != 0
